# Workspace

`Workspace` — многопанельный подход: один экран содержит несколько окон (`View`), между которыми выполняется переключение фокуса.  
Каждое окно имеет собственное "тело" (`IViewBody`), внутри которого обычно размещается собственный `WidgetContainer`.

---

## Идея

`WorkspaceScreen` представляет экран-обёртку, внутри которой:

- хранится `Workspace` со списком `View`;
- выделяется активное окно (active view);
- предусмотрен механизм переключения окон (например, Shift+Left / Shift+Right / BackTab);
- курсор устанавливается активному окну после отрисовки всех окон.

---

## Составные части

### View
`View` = `Window + Panel + IViewBody`

- `Window` — отдельное окно ncurses;
- `Panel` — управление порядком наложения окон (z-order);
- `IViewBody` — логика отрисовки и обработки ввода для данного окна.

При активации (`View.setActive(true)`) панель поднимается наверх (`top()`).

---

### IViewBody
Контракт "тела" окна:

- `render(Window w, ScreenContext ctx, bool active)`
- `handle(ScreenContext ctx, KeyEvent ev)`
- `close()`

Дополнительно может поддерживаться `ICursorOwner`. В этом случае `Workspace` вызывает `placeCursor()` для активного окна.

---

### Workspace
Отвечает за:

- список окон (`View[]`);
- активный индекс (`_active`);
- проверку `View.focusable` (окно может быть "информационным" и не участвовать в переключении);
- отрисовку всех окон + установку курсора активного окна + `doupdate()`.

---

## Поток управления в WorkspaceScreen

1. `build(context, workspace)` — единоразовая регистрация окон (`View`) в `Workspace`.
2. `onShow()` → `workspace.render(context)`.
3. `handle()`:
   - вызов `handleGlobal()`;
   - попытка переключения окна через `workspace.handleSwitcher(event)`;
   - иначе передача ввода активному окну: `workspace.handleActive(context, event)`;
   - завершающая перерисовка: `workspace.render(context)`.

---

## Фокус

### Фокус окна (между view)
- определяется индексом `Workspace._active`;
- переключается по хоткеям из `handleSwitcher()`;
- учитывает `View.focusable`:
  - `focusable=false` исключает окно из цикла переключения.

### Фокус внутри окна (виджеты)
- обычно реализуется через `WidgetContainer` внутри `IViewBody`;
- Tab переключает виджеты только внутри активного окна.

Итоговая схема:

- Shift+Left/Right → переключение окна
- Tab → переключение виджетов внутри активного окна

---

## Курсор

Рекомендуемая последовательность:

1. отрисовка всех окон (`view.render(...)` для каждого view);
2. `update_panels()`;
3. установка курсора активного окна (`activeView.placeCursor(context)` при поддержке `ICursorOwner`);
4. `doupdate()`.

Критичность порядка обусловлена тем, что обновление панелей и последующие refresh-операции могут изменить положение курсора.

---

## Область применения

`Workspace` подходит, когда:

- требуется несколько окон на одном экране (форма + справка, список + детали, лог + управление);
- требуется изоляция управления фокусом между окнами (каждое окно со своим контейнером виджетов);
- необходимо отображение информационных панелей, не участвующих в переключении фокуса (`focusable=false`).
